<Window x:Class="kuvankasittely.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        xmlns:local="clr-namespace:kuvankasittely"
        mc:Ignorable="d"
        Title="Kuvanmuokkaus" Height="450" Width="800" x:Name="tittle" KeyDown="Window_KeyDown">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <MenuItem Header="Edit">
                <MenuItem Header="Open" Click="Open_Click"/>
                <MenuItem Header="Save As File" Click="SaveAs_Click"/>
                <MenuItem Header="Canvas Size..." Click="CanvasSize_Click"/>
            </MenuItem>
            <MenuItem Header="View">
                <MenuItem Header="Zoom In" Click="ZoomIn_Click"/>
                <MenuItem Header="Zoom Out" Click="ZoomOut_Click"/>
                <MenuItem Header="Fit to Window" Click="FitToWindow_Click"/>
            </MenuItem>
            <MenuItem Header="Controls">
                <MenuItem Header="Control+Z - Undo" Click="UndoLastStroke_Click"/>
            </MenuItem>
            <MenuItem Header="Tools">
                <MenuItem x:Name="BrushPreviewMenuItem"
                          Header="Brush Preview" 
                          IsCheckable="True" 
                          IsChecked="False" 
                          Click="BrushPreviewMenu_Click"/>
            </MenuItem>
        </Menu>

        <!-- ✅ Main Area: Sidebar + Canvas -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="70"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Background="#FFF0F0F0">
                <CheckBox x:Name="Brush"
                          Content="Brush"
                          Margin="10"
                          Click="CheckBox_Checked"
                          IsChecked="False"/>
                <TextBox x:Name="BrushSize" TextWrapping="Wrap" Text="Size" Width="54" TextChanged="TextBox_TextChanged"/>
                <Border BorderBrush="Black" BorderThickness="2" 
                        Margin="10" Cursor="Hand" MouseDown="ColorSquare_Click"
                        Width="40" Height="40">
                    <Rectangle x:Name="ColorSquare"
                               Fill="Black"
                               Width="30" Height="30"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center">
                        <Rectangle.ToolTip>
                            <ToolTip Content="Click to choose color"/>
                        </Rectangle.ToolTip>
                    </Rectangle>
                </Border>
            </StackPanel>

            <Grid Grid.Column="1" Background="DarkGray">
                <Rectangle>
                    <Rectangle.Fill>
                        <DrawingBrush Viewport="0,0,20,20" ViewportUnits="Absolute" TileMode="Tile">
                            <DrawingBrush.Drawing>
                                <DrawingGroup>
                                    <GeometryDrawing Brush="White">
                                        <GeometryDrawing.Geometry>
                                            <RectangleGeometry Rect="0,0,20,20"/>
                                        </GeometryDrawing.Geometry>
                                    </GeometryDrawing>
                                    <GeometryDrawing Brush="#FFE0E0E0">
                                        <GeometryDrawing.Geometry>
                                            <GeometryGroup>
                                                <RectangleGeometry Rect="0,0,10,10"/>
                                                <RectangleGeometry Rect="10,10,10,10"/>
                                            </GeometryGroup>
                                        </GeometryDrawing.Geometry>
                                    </GeometryDrawing>
                                </DrawingGroup>
                            </DrawingBrush.Drawing>
                        </DrawingBrush>
                    </Rectangle.Fill>
                </Rectangle>

                <ScrollViewer x:Name="CanvasScrollViewer"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              Background="Transparent">
                    <Canvas x:Name="MainCanvas"
                            Background="White"
                            Width="400"
                            Height="300"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            MouseDown="Canvas_MouseDown_1"
                            MouseMove="Canvas_MouseMove_1"
                            MouseUp="Canvas_MouseUp_1">
                        <Canvas.LayoutTransform>
                            <ScaleTransform x:Name="CanvasScaleTransform" ScaleX="1.0" ScaleY="1.0"/>
                        </Canvas.LayoutTransform>
                        <Image x:Name="LoadedImage" Stretch="Fill" />
                    </Canvas>
                </ScrollViewer>

                <!-- zoom texts -->
                <TextBlock HorizontalAlignment="Right" 
                           VerticalAlignment="Bottom" 
                           Margin="10"
                           Foreground="Black"
                           x:Name="ZoomTextBlock"
                           FontSize="14" FontFamily="Franklin Gothic Medium">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="Canvas: {0} x {1} | Zoom: {2:P0}">
                            <Binding ElementName="MainCanvas" Path="Width"/>
                            <Binding ElementName="MainCanvas" Path="Height"/>
                            <Binding ElementName="CanvasScrollViewer" Path="ZoomFactor"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </Grid>
        </Grid>
    </Grid>
</Window>
